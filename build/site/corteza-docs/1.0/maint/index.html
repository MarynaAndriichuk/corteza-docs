<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Corteza Management and Maintenance :: Corteza Docs</title>
    <meta name="generator" content="Antora 2.3.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">Corteza Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="corteza-docs" data-version="1.0">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Corteza technical and user documentation</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../overview/index.html">Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/index.html#product">Product</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/index.html#security">Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/index.html#architecture">Architecture</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/index.html#core-development">Core development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/index.html#deployment">Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../overview/index.html#customization">Customization</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../user/index.html">User Manual</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../user/index.html#shell">Corteza one</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../user/index.html#messaging">Corteza Messaging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../user/index.html#crm">CRM</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../user/index.html#service-cloud">Service cloud</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../admin/index.html">Admin Manual</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../admin/index.html#admin-panel">Corteza Admin Panel</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../admin/index.html#compose">Corteza Low Code</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Management and Maintenance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#requirements">Technical Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#install">Installing Corteza</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#setup">Setup</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#backup">Backup and restore</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../extdev/index.html">Extending and Customizing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#getting-started">Getting started</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#prerequisite">Prerequisite</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#terminology">Terminology</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#system-overview">Automation System Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#security">Security</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#resource-table">Resources and Events</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#roadmap">Roadmap</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#facility">Automation System Facility</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#development">Extension Development</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#testing">Extension Testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#debugging">Extension Debugging</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../extdev/index.html#examples">Extension Examples</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ext/index.html">Extensions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ext/index.html#about">About</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ext/index.html#docusign">Docusign</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Corteza technical and user documentation</span>
    <span class="version">v1.0</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Corteza technical and user documentation</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">v1.0</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Corteza technical and user documentation</a></li>
    <li><a href="index.html">Management and Maintenance</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/cortezaproject/corteza-docs/edit/feature-antora/modules/ROOT/pages/maint/index.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Corteza Management and Maintenance</h1>
<div class="sect1">
<h2 id="_corteza_architecture_overview"><a class="anchor" href="#_corteza_architecture_overview"></a>Corteza Architecture overview</h2>
<div class="sectionbody">
<div class="ulist">
<div class="title">Mayor component or services in Corteza</div>
<ul>
<li>
<p>frontend applications (WebApps)</p>
</li>
<li>
<p>backend API (Server)</p>
</li>
<li>
<p>automation script execution engine (Corredor)</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Auxiliary services</div>
<ul>
<li>
<p>log storage</p>
</li>
<li>
<p>error tracking</p>
</li>
<li>
<p>email sending</p>
</li>
<li>
<p>object storage</p>
</li>
<li>
<p>database</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Frontend applications</div>
<ul>
<li>
<p><a href="https://github.com/cortezaproject/corteza">Auth</a> handles authentication flows, sign-up, login, password recovery, &#8230;&#8203;</p>
</li>
<li>
<p><a href="https://github.com/cortezaproject/corteza">Admin</a> is used for instance administration, settings, user overview, general permission management</p>
</li>
<li>
<p><a href="https://github.com/cortezaproject/corteza">Low Code</a> is a <a href="https://en.wikipedia.org/wiki/Low-code_development_platform">low-code development platform</a> and allows creation of record-absed business applications</p>
</li>
<li>
<p><a href="https://github.com/cortezaproject/corteza">Messaging</a> collaboration platform that allows teams to collaborate more efficiently and communicate safely with other organizations or customers</p>
</li>
<li>
<p><a href="https://github.com/cortezaproject/corteza">One</a> is a unified workspace to access and run third-party web and Corteza applications. Centralized access management from a single console enables administrative control over who can see or access applications</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/assets/arch-overview.png" alt="Corteza architectural overview">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="requirements"><a class="anchor" href="#requirements"></a>Technical Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Corteza is a server application that can be accessed through a browser on a workstation, laptop or mobile device.</p>
</div>
<div class="paragraph">
<p>For testing and exploring Corteza you do not need an external, externally accessible software.
Corteza can deploy on a local machine.</p>
</div>
<div class="sect2">
<h3 id="_client_software"><a class="anchor" href="#_client_software"></a>Client software</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Supported web browsers and versions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chrome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v78+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Firefox</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v68+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Safari</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v12+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">v44+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iOS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iPhone 5s devices and later with iOS 12+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Android</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Android 7+</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_server"><a class="anchor" href="#_server"></a>Server</h3>
<div class="sect3">
<h4 id="_software"><a class="anchor" href="#_software"></a>Software</h4>
<div class="sect4">
<h5 id="_server_operating_system"><a class="anchor" href="#_server_operating_system"></a>Server Operating System</h5>
<div class="paragraph">
<p>Any Docker-compatible operating system (Linux-based OS is recommended, preferably Ubuntu LTS)</p>
</div>
</div>
<div class="sect4">
<h5 id="_http_server"><a class="anchor" href="#_http_server"></a>HTTP server</h5>
<div class="paragraph">
<p>Web application and API should be placed behind a firewall and/or a HTTP reverse proxy.
The responsibility of this proxy is to forward traffic to Corteza services and do <a href="https://en.wikipedia.org/wiki/TLS_termination_proxy">SSL termination</a>.
Most of the <a href="https://en.wikipedia.org/wiki/TLS_termination_proxy">popular HTTP servers</a> have this capability.</p>
</div>
<div class="paragraph">
<p>Corteza provides configuration guide for <a href="https://github.com/jwilder/nginx-proxy">Nginx Reverse Proxy</a> and for <a href="https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion">LetsEncrypt companion container for nginx-prox</a>.</p>
</div>
<div class="paragraph">
<p>Nginx is not required, you can use HTTP server you are familiar with.
Use provided examples for Nginx as a reference on how to configure it.</p>
</div>
</div>
<div class="sect4">
<h5 id="_docker"><a class="anchor" href="#_docker"></a>Docker</h5>
<div class="paragraph">
<p>Minimum version for Docker Engine is 1.12.x</p>
</div>
</div>
<div class="sect4">
<h5 id="_database_software"><a class="anchor" href="#_database_software"></a>Database Software</h5>
<div class="paragraph">
<p>Percona Server for MySQL 8.x (on host, managed or provided by Corteza through Docker image)</p>
</div>
<div class="paragraph">
<p>Corteza supports Docker and Docker Compose based setup and deployment.
You should familiarize yourself with both <a href="https://docs.docker.com/engine/docker-overview/">Docker</a> and <a href="https://docs.docker.com/compose/">Docker Compose</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_hardware"><a class="anchor" href="#_hardware"></a>Hardware</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of Users</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 - 500</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 vCPU/cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 GB RAM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">500 - 1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 vCPU/cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 GB RAM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000 - 2000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 vCPU/cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 GB RAM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000 - 5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 vCPU/cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 GB RAM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16 vCPU/cores</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 GB RAM</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_storage"><a class="anchor" href="#_storage"></a>Storage</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Estimated storage per user per month</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Recommended Storage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Low volume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messaging: sending text messages and links (without file upload)</p>
<p class="tableblock">Low Code: creating plain text records (without file upload)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5 MB/user/month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medium volume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messaging: sending text messages, links and occasionally sending documents and images</p>
<p class="tableblock">Low Code: attaching documents and images to records</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">25 MB/user/month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">High volume</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messaging: uploading large files on a daily basis</p>
<p class="tableblock">Low Code: attaching a high number of documents and images to records on a daily basis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100 MB/user/month</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<div class="title">Annual storage calculation</div>
<ul>
<li>
<p>Base storage (operating system) = 10 GB</p>
</li>
<li>
<p>Recommended storage per user per month based on the matrix above (multiplied by 12 to get yearly amount)</p>
</li>
<li>
<p>Average number of users in a year</p>
</li>
<li>
<p>Safety factor of 2.0 is recommended</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">Formula</div>
<div class="content">
<pre>total = (nr. of users * recommended storage * 12 * safety factor) + base storage</pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example calculation for 30 medium usage users:</div>
<div class="content">
<pre>Recommended storage = (30 * 25 MB * 12 * 2) + 10 GB = 28 GB / year</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_network"><a class="anchor" href="#_network"></a>Network</h4>
<div class="paragraph">
<p>Corteza does need some access to outside services, depending on configuration and customization of the deployment.</p>
</div>
<div class="paragraph">
<p>SMTP servers should be configured and accessible if deployment uses email address confirmation on sign-in, password recovery or other kinds of email notifications.</p>
</div>
<div class="paragraph">
<p>HTTP traffic should be allowed if there OAuth2 or OIDC sign-up is enabled or there are custom scripts that access external URLs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_domain_hostnames"><a class="anchor" href="#_domain_hostnames"></a>Domain, hostname(s)</h4>
<div class="paragraph">
<p>Setup with 2 domains (api + app) is the most common one:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>hostname for Web application</p>
</li>
<li>
<p>hostname for API server</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you already own a domain, you can add two or more hosts and use them to access your Corteza instance.</p>
</div>
<div class="sect4">
<h5 id="_testing_locally"><a class="anchor" href="#_testing_locally"></a>Testing locally</h5>
<div class="paragraph">
<p>Alternatively, when doing local-only demo/test deployment, you can use our <code>127.0.0.1</code> wildcard alias <code>*.local.cortezaproject.org</code>.
Wildcard alias provides a simple way to get any domain under <code>local.cortezaproject.org</code> (<code>api.local.cortezaproject.org</code> for example) to point to <a href="https://en.wikipedia.org/wiki/Localhost">localhost</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You can not use local.cortezaproject.org for public Corteza deployments.
It will always point to your local machine.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpsssl_certificates"><a class="anchor" href="#_httpsssl_certificates"></a>HTTPS/SSL Certificates</h4>
<div class="paragraph">
<p>Corteza supports any kind of SSL certificate from all certificate authorities (CA).
You can use any existing or new SSL certificate from any commercial SSL certificate provider, self-signed or provided by service like <a href="https://en.wikipedia.org/wiki/Let&#8217;s_Encrypt">Let&#8217;s Encrypt</a>.</p>
</div>
<div class="paragraph">
<p>If you do not use any other HTTP server, we highly recommend setup with <a href="https://github.com/jwilder/nginx-proxy">Nginx Reverse Proxy</a> and <a href="https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion">LetsEncrypt companion container for nginx-prox</a>.
It provides fully automated and simplest way to secure Corteza or any other web application you host.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="install"><a class="anchor" href="#install"></a>Installing Corteza</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_corteza_with_docker_compose"><a class="anchor" href="#_corteza_with_docker_compose"></a>Corteza with Docker Compose</h3>
<div class="sect3">
<h4 id="_set_up_docker"><a class="anchor" href="#_set_up_docker"></a>Set up Docker</h4>
<div class="paragraph">
<p>If Docker is already set up on the machine where you want to use Corteza, you can skip this section.
If you are using a Docker version below 18.0, I strongly encourage you to update.</p>
</div>
<div class="listingblock">
<div class="title">If you&#8217;re not sure whether you have Docker, open your console or terminal and enter:</div>
<div class="content">
<pre>docker -v</pre>
</div>
</div>
<div class="paragraph">
<p>If the response is "command not found," download and install a Docker community edition for <a href="https://www.docker.com/products/docker-desktop">desktop</a> or <a href="https://hub.docker.com/search?offering=community&amp;type=edition">server or cloud</a> that fits your environment.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.docker.com/install/#server">Docker installation guide</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/compose/install/">Docker Compose installation guide</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_files"><a class="anchor" href="#_configuration_files"></a>Configuration files</h4>
<div class="paragraph">
<p>Very base Corteza service configuration for Docker Compose consists of one or two files:
obligatory <code>docker-compose.yaml</code> and <code>.env</code> file.</p>
</div>
<div class="sect4">
<h5 id="_environment_file_env"><a class="anchor" href="#_environment_file_env"></a>Environment file (.env)</h5>
<div class="paragraph">
<p>The format for environment files is simple and clean with one <code>KEY=VALUE</code> per line.
File usually has the name <code>.env</code> and is placed in the same directory as an application.
In Docker Compose context it is placed in the same directory as <code>docker-compose.yaml</code> configuration file.</p>
</div>
<div class="olist arabic">
<div class="title">Environment file is used on three levels:</div>
<ol class="arabic">
<li>
<p>Configuring Docker Compose itself.
Implicit, as <code>.env</code> file in the same directory as <code>docker-compose.yaml</code>)</p>
</li>
<li>
<p>Utilize values for docker-compose configuration.
Implicit, as <code>.env</code> file in the same directory as <code>docker-compose.yaml</code>)</p>
</li>
<li>
<p>Passed to configured services.
Environment file(s) must be explicitly referenced by each service (<code>env_file: [ .env ]</code>)
You can use <code>.env</code> or one or more environment files.
See <a href="#_delaying_api_execution">Delaying API execution</a>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-dotenv hljs" data-lang="dotenv"># Docker images version <i class="conum" data-value="1"></i><b>(1)</b>
VERSION=latest <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Comment line</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Key and value</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_docker_compose_yaml_file"><a class="anchor" href="#_docker_compose_yaml_file"></a>docker-compose.yaml file</h5>
<div class="paragraph">
<p>This file describes service, network and storage configuration in a human and machine readable format.</p>
</div>
<div class="paragraph">
<p>Full Docker Compose file reference documentation is available on <a href="https://docs.docker.com/compose/compose-file/">docs.docker.com</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>YAML (a recursive acronym for "YAML Ain&#8217;t Markup Language") is a human-readable data-serialization language.
It is commonly used for configuration files and in applications where data is being stored or transmitted.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Environmental variables from <code>.env</code> can be utilized to make <code>docker-compose.yaml</code> file more compact, modular and simpler to change.
You can define a variable (like <code>VERSION</code>) and then use it inside yaml file (as ${VERSION}`).</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_basic_setup_for_local_demo"><a class="anchor" href="#_basic_setup_for_local_demo"></a>Basic setup for local demo</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Provided configuration files for demo a few extra settings that enable it to run on a local environment.
All services are on the same network, ports binded to host&#8217;s network, etc.</p>
</div>
<div class="paragraph">
<p>This is not optimal setup for production environment.
See <a href="#_nginx_proxy">Nginx Proxy</a> and <a href="#_production_deployment">Production deployment</a> below configuration examples that are more suited for production deployment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>.env</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-dotenv hljs" data-lang="dotenv">Unresolved include directive in modules/ROOT/pages/maint/install/basic.adoc - include::examples/basic/.env[]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>docker-compose.yaml</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Unresolved include directive in modules/ROOT/pages/maint/install/basic.adoc - include::examples/basic/docker-compose.yaml[]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Some of the configuration lines in the provided YAML examples and files are written in a single line for brevity and simpler enabling/disabling (commenting-out).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create an empty directory, with <code>.env</code> and <code>docker-compose.yaml</code> files and copy contents from the examples above.
Some operating systems do not like files that start with a dot so make sure <code>.env</code> file is properly named.</p>
</div>
<div class="listingblock">
<div class="title">Start all services (database, server, corredor, webapp)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker-compose up -d</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Running <code>docker-compose ps</code> should produce something like:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Unresolved include directive in modules/ROOT/pages/maint/install/basic.adoc - include::examples/basic/output-ps.txt[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see 4 services up and running.
Two of them are accessible on localhost (ports 8080 and 8081).</p>
</div>
<div class="paragraph">
<p>Direct your browser to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code> (use another port if you changed value for <code>LOCAL_DEMO_SPA_PORT</code>).
On first visit, you should be redirected to <code>/auth</code> where you can login, sign up, etc.</p>
</div>
<div class="paragraph">
<p>Create your account through the sign-up form.
Corteza detects if the database is empty and auto-promotes first user to administration role.</p>
</div>
<div class="listingblock">
<div class="title">Stopping and removing containers and date (do not ask for confirmation, stop containers if running and remove volumes)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker-compose rm --force --stop -v</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other useful docker-compose commands:</p>
</div>
<div class="listingblock">
<div class="title">View container output (logs) and follow output and output 20 lines from each service</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker-compose logs --follow --tail 20</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nginx_proxy"><a class="anchor" href="#_nginx_proxy"></a>Nginx Proxy</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Nginx Proxy setup is not needed for local testing.
Instructions from <a href="#_basic_setup_for_local_demo">Basic setup for local demo</a> are enough to get local demo up &amp; running.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="https://github.com/jwilder/nginx-proxy">Nginx Proxy</a> (docker image <code>jwilder/nginx-proxy</code>) is auto-configurable reverse-proxy that routes traffic from your public IP to containers on the host
<a href="https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion">LetsEncrypt Nginx Proxy Companion</a> (docker image <code>jrcs/letsencrypt-nginx-proxy-companion</code>) handles the automated creation, renewal and use of Let&#8217;s Encrypt certificates for proxyed Docker containers.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In the following instructions, we assume you don&#8217;t have anything similar set up on your current environment. If you have other means to provide traffic forwarding and/or SSL certificate handling, proceed with caution!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Please see <a href="https://github.com/jwilder/nginx-proxy">Nginx Proxy</a> and <a href="https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion">LetsEncrypt Nginx Proxy Companion</a> Github pages to</p>
</div>
<div class="olist arabic">
<div class="title">How it works &amp; benefits</div>
<ol class="arabic">
<li>
<p>Both images mount /var/run/docker.sock (read-only) and listen to docker events (when containers start or stop)</p>
</li>
<li>
<p>Containers (like Corteza server, and fronted application) that are exposed publicly no longer have to publish their ports on public IP</p>
</li>
<li>
<p>No complicated firewall or network forwarding rules are needed</p>
</li>
<li>
<p>Containers MUST (also) be on the same network as <code>nginx-proxy</code> (in the examples we&#8217;re using network named <code>proxy</code>)</p>
</li>
<li>
<p>Nginx Proxy detects <code>VIRTUAL_HOST</code> on each container that comes online.
Then it auto-generates configuration, reloads itself and starts forwarding HTTP traffic to that container</p>
</li>
<li>
<p>LetsEncrypt companion detects <code>LETSENCRYPT_HOST</code> and starts certificate creation process with LE.
It also reconfigures nginx-proxy, adds certificates and enables redirection from HTTP to HTTPS</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title"><code>docker-compose.yaml</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Unresolved include directive in modules/ROOT/pages/maint/install/nginx-proxy.adoc - include::examples/nginx-proxy/docker-compose.yaml[]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Add <code>custom.conf</code> Nginx configuration file next to <code>docker-compose.yaml</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>Unresolved include directive in modules/ROOT/pages/maint/install/nginx-proxy.adoc - include::examples/nginx-proxy/custom.conf[]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Start both services</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker-compose up -d</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Running <code>docker-compose ps</code> should produce something like:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Unresolved include directive in modules/ROOT/pages/maint/install/nginx-proxy.adoc - include::examples/nginx-proxy/output-ps.txt[]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_production_deployment"><a class="anchor" href="#_production_deployment"></a>Production deployment</h3>
<div class="paragraph">
<p>This example describes production-ready deployment.
It depends on running nginx-proxy service (see <a href="#_nginx_proxy">Nginx Proxy</a>)</p>
</div>
<div class="paragraph">
<p>This demo uses 2 example domains: <code>your-demo.example.tld</code> and <code>api.your-demo.example.tld</code>.
You should configure your DNS, add 2 hosts and point them to the IP address (A record) or hostname (CNAME record) of the server you&#8217;re using for Corteza deployment.</p>
</div>
<div class="listingblock">
<div class="title"><code>.env</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-dotenv hljs" data-lang="dotenv">Unresolved include directive in modules/ROOT/pages/maint/install/production.adoc - include::examples/production/.env[]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title"><code>docker-compose.yaml</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">Unresolved include directive in modules/ROOT/pages/maint/install/production.adoc - include::examples/production/docker-compose.yaml[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create an empty directory, with <code>.env</code> and <code>docker-compose.yaml</code> files and copy contents from the examples above.
Some operating systems do not like files that start with a dot so make sure <code>.env</code> file is properly named.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We advise against merging/mixing Corteza and <code>nginx-proxy</code> in the same directory.</p>
</div>
<div class="paragraph">
<p>It can be done but requires some experience with Docker Compose.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Make sure your nginx-proxy service is running before running.
If nginx-proxy service is not started or you changed your configuration somehow, you might get error like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ERROR: Network proxy declared as external, but could not be found. Please create the network manually using `docker network create proxy` and try again.</pre>
</div>
</div>
<div class="paragraph">
<p>Inspect your configuration files and compare them with ones provied in this documentation.</p>
</div>
<div class="listingblock">
<div class="title">Start all services (database, server, corredor, webapp)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker-compose up -d</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Running <code>docker-compose ps</code> should produce something like:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Unresolved include directive in modules/ROOT/pages/maint/install/production.adoc - include::examples/production/output-ps.txt[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see 4 services up and running.
Your services should soon (under a couple of minutes) be available on the configured domains.</p>
</div>
<div class="paragraph">
<p>Direct your browser to <code><a href="http://your-demo.example.tld" class="bare">http://your-demo.example.tld</a></code>.
On first visit, you should be redirected to <code>/auth</code> where you can login, sign up, etc.</p>
</div>
<div class="paragraph">
<p>Create your account through the sign-up form.
Corteza detects if the database is empty and auto-promotes first user to administration role.</p>
</div>
<div class="listingblock">
<div class="title">Stopping and removing containers and date (do not ask for confirmation, stop containers if running and remove volumes)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker-compose rm --force --stop -v</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other useful docker-compose commands:</p>
</div>
<div class="listingblock">
<div class="title">View container output (logs) and follow output and output 20 lines from each service</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker-compose logs --follow --tail 20</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_relaying_inbound_email_to_corteza_with_postfix"><a class="anchor" href="#_relaying_inbound_email_to_corteza_with_postfix"></a>Relaying inbound email to Corteza with Postfix</h3>
<div class="paragraph">
<p>This quick how-to show what and where to modify in Postfix' configuration files to enable forwarding emails to Corteza.</p>
</div>
<div class="listingblock">
<div class="title">Change <code>/etc/postfix/main.cf</code>:</div>
<div class="content">
<pre class="highlightjs highlight"><code>virtual_alias_maps = pcre:/etc/postfix/virtual_alias</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Add virtual alias to <code>/etc/postfix/virtual_alias</code>:</div>
<div class="content">
<pre class="highlightjs highlight"><code># Catch-all for corteza.domain.tld and redirect it to corteza_sink mailbox
/.+@corteza\.domain\.tld$/ corteza_sink</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Update virtual-alias map/db file and restart postfix</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">postmap /etc/postfix/virtual_alias
postfix reload</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Add entry to <code>/etc/aliases</code></div>
<div class="content">
<pre class="highlightjs highlight"><code>corteza_sink: "| https://api.your-corteza-instance.tld/system/system/sink?content-type=email&expires=&method=POST&origin=postfix&sign=6280d530ae74f1f9c55e4dd362c9ef2094221287'"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This forwards mail for specific mailbox a curl command.
Curl command then pushes that raw email to sink endpoint on Corteza API.</p>
</div>
<div class="paragraph">
<p>See <a href="../setup/email-automation.adoc">email automation setup</a> for in information how to create a signed URL</p>
</div>
<div class="listingblock">
<div class="title">Update aliases</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">newaliases</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Test changes</strong></p>
</div>
<div class="paragraph">
<p>You can verify if configuration changes have desired effect by sending an email to the configured address or
with a simple command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">echo "hello corteza"|mail -s 'hello' test@corteza.domain.tld</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>It&#8217;s best if you try this from a different machine than the one running postfix</em></p>
</div>
<div class="paragraph">
<p>This should produce a new entry in your mail log (usually `/var/log/mail.log) where you can see information about
received email</p>
</div>
<div class="listingblock">
<div class="title">Log example:</div>
<div class="content">
<pre class="highlightjs highlight"><code>postfix/smtpd[23155]: connect from some-host.tld[xxx.xxx.xxx.xxx]
postfix/smtpd[23155]: 277AF5C1B78: client=some-host.tld[xxx.xxx.xxx.xxx]
postfix/cleanup[23159]: 277AF5C1B78: message-id=&lt;b808218e-ce41-6cbf-cb4f-be2b4cf8f776@crust.tech&gt;
postfix/qmgr[14490]: 277AF5C1B78: from=&lt;sender@some-host.tld&gt;, size=1476, nrcpt=1 (queue active)
postfix/smtpd[23155]: disconnect from some-host.tld[xxx.xxx.xxx.xxx] ehlo=2 starttls=1 mail=1 rcpt=1 data=1 quit=1 commands=7
postfix/local[23160]: 277AF5C1B78: to=&lt;corteza_sink@my-server&gt;, orig_to=&lt;demo@corteza.domain.tld&gt;, relay=local, delay=0.67, delays=0.03/0.01/0/0.62, dsn=2.0.0, status=sent (delivered to command:  curl --data-binary @- 'https://api.your-corteza-instance.tld/system/sink?content-type=email&amp;expires=&amp;method=POST&amp;origin=postfix&amp;sign=6280d530ae74f1f9c55e4dd362c9ef2094221287'')
postfix/qmgr[14490]: 277AF5C1B78: removed</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_forward_logs_to_elk"><a class="anchor" href="#_forward_logs_to_elk"></a>Forward logs to ELK</h3>
<div class="paragraph">
<p>Corteza server can log requests, responses, errors and other events as JSON.
By default, this logs are outputted to Docker container console.
You can configure your (docker-compose) services to forward these logs to an external service.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve prepared <code>cortezaproject/elk</code> docker image with the necessary setup that can consume and</p>
</div>
<div class="sect3">
<h4 id="_using_gelf_docker_logging_driver_and_gelf_elk_server"><a class="anchor" href="#_using_gelf_docker_logging_driver_and_gelf_elk_server"></a>Using GELF docker logging driver and GELF ELK server</h4>
<div class="paragraph">
<p>The following example assumes you&#8217;ve taken configuration from <a href="https://github.com/cortezaproject/elk">cortezaproject/elk</a> without any changes.
You should also extend defined services in your <code>docker-compose.yml</code> with <code>networks</code> and <code>logging</code> section:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml"># ...
    networks: [ elk ] # or add elk to networks you already have
    logging:
      driver: gelf
      options:
        gelf-address: "tcp://elk:12201"
# ...</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup"><a class="anchor" href="#setup"></a>Setup</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_corteza_command_line_interface_cli"><a class="anchor" href="#_corteza_command_line_interface_cli"></a>Corteza Command Line Interface (CLI)</h3>
<div class="paragraph">
<p>Corteza comes with command line interface tool. With it, you can manually or automatically change applications settings,
add users, roles, and run the API. You are using the same binary that can start the backend service and the API.</p>
</div>
<div class="ulist">
<div class="title">Depending on built flavour, you can use a different entry:</div>
<ul>
<li>
<p>Microservice build produce <code>corteza-server-system</code>, <code>corteza-server-messaging</code> and <code>corteza-server-compose</code></p>
</li>
<li>
<p>Monolith build produces <code>corteza-server</code> binary with system, messaging, compose subcommands</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_using_the_cli_tool"><a class="anchor" href="#_using_the_cli_tool"></a>Using the CLI tool</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
At least basic <a href="https://docs.docker.com/engine/docker-overview/">Docker</a> and <a href="https://docs.docker.com/compose/">Docker Compose</a> knowledge is required for most Corteza setup and management.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Executing with Docker Compose (when service is started)</div>
<div class="content">
<pre class="highlightjs highlight"><code>docker-compose exec &lt;service name&gt; help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Executing with docker (when container is running)</div>
<div class="content">
<pre class="highlightjs highlight"><code>docker exec -it &lt;container name&gt; help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Running with Docker Compose (when service is not started)</div>
<div class="content">
<pre class="highlightjs highlight"><code>docker run -it --rm &lt;container name&gt; help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Executing with Docker (when container is not running)</div>
<div class="content">
<pre class="highlightjs highlight"><code>docker run -it --rm [docker run options] &lt;container name&gt; help</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Running and executing with Docker Compose should be easier and simpler because all required options and settings
for container are packed in the Docker Compose project configuration file (<code>docker-compose.yaml</code>)
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Start HTTP Server with REST API</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server serve-api [flags]

Flags:
  -h, --help   help for serve-api</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Provision tasks</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server provision [command]

Available Commands:
  configuration    Create permissions &amp; resources
  migrate-database Run database migration scripts

Flags:
  -h, --help   help for provision

Use "corteza-server provision [command] --help" for more information about a command.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Create permissions &amp; resources</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server provision configuration [flags]

Flags:
  -h, --help   help for configuration</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Run database migration scripts</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server provision migrate-database [flags]

Flags:
  -h, --help   help for migrate-database</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">External authentication</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system auth [command]

Available Commands:
  auto-discovery     Auto discovers new OIDC client
  jwt                Generates new JWT for a user
  test-notifications Sends samples of all authentication notification to receipient

Flags:
  -h, --help   help for auth

Use "corteza-server system auth [command] --help" for more information about a command.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Auto discovers new OIDC client</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system auth auto-discovery [name] [url] [flags]

Flags:
      --enable            Enable this provider and external auth
  -h, --help              help for auto-discovery
      --skip-validation   Skip validation</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sends samples of all authentication notification to receipient</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system auth test-notifications [recipient] [flags]

Flags:
  -h, --help   help for test-notifications</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Generates new JWT for a user</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system auth jwt [email-or-id] [flags]

Flags:
  -h, --help   help for jwt</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Export system resources</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system export [flags]

Flags:
  -h, --help          help for export
  -p, --permissions   Export system permissions
  -s, --settings      Export settings</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Import</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system import [flags]

Flags:
  -h, --help   help for import</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Role management</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system roles [command]

Available Commands:
  useradd     Add user to role

Flags:
  -h, --help   help for roles

Use "corteza-server system roles [command] --help" for more information about a command.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Add user to role</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system roles useradd [role-ID-or-name-or-handle] [user-ID-or-email] [flags]

Flags:
  -h, --help   help for useradd</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Settings management</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system settings [command]

Available Commands:
  delete      Set value (raw JSON) for a specific key (or by prefix)
  export      Import settings as JSON to stdout or file
  get         Get value (raw JSON) for a specific key
  import      Import settings as JSON from stdin or file
  list        List all
  set         Set value (raw JSON) for a specific key

Flags:
  -h, --help   help for settings

Use "corteza-server system settings [command] --help" for more information about a command.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Set value (raw JSON) for a specific key (or by prefix)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system settings delete [keys, ...] [flags]

Flags:
  -h, --help            help for delete
      --prefix string   Filter settings by prefix</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Import settings as JSON to stdout or file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system settings export [file] [flags]

Flags:
  -h, --help   help for export</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Get value (raw JSON) for a specific key</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system settings get [key to get, ...] [flags]

Flags:
  -h, --help   help for get</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Import settings as JSON from stdin or file</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system settings import [file] [flags]

Flags:
  -h, --help   help for import</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">List all</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system settings list [flags]

Flags:
  -h, --help            help for list
      --prefix string   Filter settings by prefix</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Set value (raw JSON) for a specific key</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system settings set [key to set] [value] [flags]

Flags:
  -h, --help   help for set</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sink</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system sink [command]

Available Commands:
  signature   Creates signature for sink HTTP endpoint

Flags:
  -h, --help   help for sink

Use "corteza-server system sink [command] --help" for more information about a command.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Creates signature for sink HTTP endpoint</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system sink signature [flags]

Flags:
      --content-type string   Content type (optional)
      --expires string        Date of expiration (YYYY-MM-DD, optional)
  -h, --help                  help for signature
      --method string         HTTP method that will be used (default "GET")
      --origin string         Origin of the request (arbitrary string, optional)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">User management</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system users [command]

Available Commands:
  add         Add new user
  list        List users
  password    Change password for user

Flags:
  -h, --help   help for users

Use "corteza-server system users [command] --help" for more information about a command.</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Add new user</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system users add [email] [flags]

Flags:
  -h, --help          help for add
      --no-password   Create user without password</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">List users</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system users list [flags]

Flags:
  -h, --help   help for list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Change password for user</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server system users password [email] [flags]

Flags:
  -h, --help   help for password</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Specify one ("modules", "pages", "charts", "permissions") or more resources to export</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server compose export [flags]

Flags:
  -h, --help               help for export
      --namespace string   Export namespace resources (by ID or string)
  -p, --permissions        Export system permissions
  -s, --settings           Export settings</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Import</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server compose import [flags]

Flags:
  -h, --help               help for import
      --namespace string   Import into namespace (by ID or string)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Export Messaging resources</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server messaging export [flags]

Flags:
  -h, --help          help for export
  -p, --permissions   Export system permissions
  -s, --settings      Export settings</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Import</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">Usage:
  corteza-server messaging import [flags]

Flags:
  -h, --help   help for import</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_api_server"><a class="anchor" href="#_api_server"></a>API Server</h3>
<div class="sect3">
<h4 id="_provisioning"><a class="anchor" href="#_provisioning"></a>Provisioning</h4>
<div class="paragraph">
<p>Provisioning is step after server is started and API becomes available.
It allows you to directly influence how a fresh Corteza instance is configured on first run.
This entire process can be disabled by setting env. variables <code>PROVISION_MIGRATE_DATABASE</code> and <code>PROVISION_CONFIGURATION</code> to <code>false</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Control provisioning procedure</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_MIGRATE_DATABASE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls if database migration (creation of tables, changes of schema between versions) should be done before each service is started.</p>
<p class="tableblock">It&#8217;s recommended to keep this setting on.
Disabling it on a running server prevents migration between version udpates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_CONFIGURATION</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runs various auto-setup procedures and creates resources:</p>
<p class="tableblock">- creates default permission rules and roles
- default channels are created
- default applications are created
- compose resources (namespaces, modules, charts,&#8230;&#8203;)
- settings auto-discovery</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Provision authentication settings:</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_ENABLED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.external.enabled</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is OAuth2 enabled or disabled</p>
<p class="tableblock">OAuth2 flow redirection URL.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_REDIRECT_URL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.external.redirect-url</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">searches env-variables (<code>DOMAIN</code>, <code>LETSENCRYPT_HOST</code>, <code>VIRTUAL_HOST</code>, <code>HOSTNAME</code>, <code>HOST</code>)
and uses additional info (monolith, api-base-url) to calculate the value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_SESSION_STORE_SECRET</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.external.session-store-secret</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><em>random 64 char string</em></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generated 64 char long string if missing.</p>
<p class="tableblock">Is session cookie "secure" flag used (if yes, cookie can only be access over HTTPS).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_SESSION_STORE_SECURE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.external.session-store-secure</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If HTTPS is used for external auth redirection url, value is set to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_FRONTEND_URL_BASE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.frontend.url.base</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the frontend SPA is located. Serves as base for generating other <code>auth.frontend.url&#8230;&#8203;</code> variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_FRONTEND_URL_PASSWORD_RESET</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.frontend.url.password-reset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the frontend SPA is located, the password reset form.</p>
<p class="tableblock">Where the frontend SPA is located, password email confirmation page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_FRONTEND_URL_EMAIL_CONFIRMATION</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.frontend.url.email-confirmation</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><code>auth.frontend.url.base</code> is used as base URL</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_FRONTEND_URL_REDIRECT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.frontend.url.redirect</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the frontend SPA is located. User will be redirected here on successful external authentication.
Auto discovery uses <code>auth.frontend.url.base</code> as base URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EMAIL_FROM_ADDRESS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.mail.from-address</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code><a href="mailto:to-be-configured@example.tld">to-be-configured@example.tld</a></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email address used for sending auth emails (password reset, email confirmation)</p>
<p class="tableblock">Name used for sending auth emails (password reset, email confirmation)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EMAIL_FROM_NAME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.mail.from-name</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corteza Team (to-be-configured)</p>
<p class="tableblock">Is internal auth enabled? Enable this to allow users to use all (enabled)
internal features (sign-up, log in&#8230;&#8203;.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.internal.signup</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_INTERNAL_ENABLED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_INTERNAL_SIGNUP_ENABLED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.internal.signup.enabled</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is internal sign-up enabled? Enable this to allow users to register if you do not have external authentication providers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_INTERNAL_SIGNUP_EMAIL_CONFIRMATION_REQUIRED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.internal.signup-email-confirmation-required</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is email confirmation required for internal sign-ups?
Enabled on auto-discovery if server has email capabilities (<code>SMTP_HOST</code> variable is set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_INTERNAL_PASSWORD_RESET_ENABLED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>auth.internal.password-reset.enabled</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is password reset enabled for internal account?
Auto-discovery enables this if server has email capabilities (<code>SMTP_HOST</code> variable is set)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Provision OIDC providers:</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_OIDC_PROVIDER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Registers all given providers on start.
Provide a list of space delimited provider pairs (<code>&lt;name&gt; &lt;provider-url&gt;</code> or
<code>&lt;name&gt; &lt;provider-url&gt; &lt;name-2&gt; &lt;provider-url-2&gt;</code>).</p>
<p class="tableblock">The provider is auto-discovered only if it does not exist (match by name).</p>
<p class="tableblock">Also, make sure that your redirect URL (<code>auth.external.redirect-url</code>) is properly.
and <code>PROVISION_SETTINGS_AUTH_EXTERNAL_REDIRECT_URL</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_REDIRECT_URL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets value for <code>auth.external.redirect-url</code> setting.</p>
<p class="tableblock">This should be set to: <code><a href="https://api.your-corteza-instance.tld/system/auth/external/%s/callback" class="bare">https://api.your-corteza-instance.tld/system/auth/external/%s/callback</a></code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Provision other external provider</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_GITHUB</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Github&#8217;s app credentials: <code>&lt;key&gt; &lt;secret&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_FACEBOOK</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Facebook&#8217;s app credentials: <code>&lt;key&gt; &lt;secret&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_GPLUS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Google&#8217;s app credentials: <code>&lt;key&gt; &lt;secret&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_LINKEDIN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LinkedIn&#8217;s app credentials: <code>&lt;key&gt; &lt;secret&gt;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_SETTINGS_AUTH_EXTERNAL_OIDC</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OIDC provider settings <code>&lt;name&gt; &lt;issuer&gt; &lt;key&gt; &lt;secret&gt;</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_server_options"><a class="anchor" href="#_server_options"></a>Server options</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_ENABLED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable/disable Corredor integration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_ADDR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>corredor:80</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname and port of the Corredor gRPC server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_LOG_ENABLED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log communication with Corredor</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_MAX_BACKOFF_DELAY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 minute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max delay for backoff on connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_API_BASE_URL_SYSTEM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instructions passed to Corredor on every call - where Corteza API is located.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_API_BASE_URL_MESSAGING</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instructions passed to Corredor on every call - where Corteza API is located.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_API_BASE_URL_COMPOSE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instructions passed to Corredor on every call - where Corteza API is located.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>DB_DSN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>corteza:corteza@tcp(db:3306)/corteza?collation=utf8mb4_general_ci</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database connection string &lt;username&gt;:&lt;password&gt;@(&lt;host&gt;:&lt;port&gt;)/&lt;dbname&gt;?collation=utf8mb4_general_ci</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>DB_LOGGER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log SQL queries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>DB_MAX_TRIES</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>100</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max number of connection retries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>DB_CONN_ERR_DELAY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5 seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How long do we wait between retries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>DB_CONN_TIMEOUT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 minute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For how long do we try to connect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>GRPC_SERVER_NETWORK</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tcp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network to use for gRPC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>GRPC_SERVER_ADDR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:50051</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where do we listen for gRPC connections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>GRPC_CLIENT_BACKOFF_DELAY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 minute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max delay for backoff on connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>GRPC_CLIENT_LOG</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log gRPC communication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_ADDR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>:80</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP &amp; port for HTTP server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_LOG_REQUEST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_LOG_RESPONSE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log responses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_ENABLE_VERSION_ROUTE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable /version route</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_ENABLE_DEBUG_ROUTE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable /debug route</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_METRICS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable (prometheus) metrics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_METRICS_NAME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>corteza</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name for metrics endpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_METRICS_USERNAME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metrics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username for metrics endpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_METRICS_PASSWORD</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(random)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for metrics endpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_REPORT_PANIC</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Report panic to Sentry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_CLIENT_TSL_INSECURE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow insecure (invalid, expired TSL/SSL cert)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>HTTP_CLIENT_TIMEOUT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30 seconds</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default timeout for clients</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>AUTH_JWT_SECRET</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(random)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secret used for signing JWT tokens</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>AUTH_JWT_EXPIRY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1 month</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expiration time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>MONITOR_INTERVAL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5 minutes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output (log) interval for monitoring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_MIGRATE_DATABASE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Migrate database (if needed) on server start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>PROVISION_CONFIGURATION</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import configuration (only on empty database) on server start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SENTRY_DSN</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to enable Sentry client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SENTRY_DEBUG</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print out debugging information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SENTRY_ATTACH_STACKTRACE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attach stacktraces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SENTRY_SAMPLE_RATE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>float32</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sample rate for event submission (0.0 - 1.0, defaults to 1.0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SENTRY_MAX_BREADCRUMBS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of breadcrumbs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SENTRY_SERVERNAME</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set reported Server name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SENTRY_RELEASE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>(current version)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set reported Release</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SENTRY_DIST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set reported distribution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SENTRY_ENVIRONMENT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set reported environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SMTP_HOST</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localhost:25</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SMTP_PORT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>int</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SMTP_USER</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SMTP_PASS</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>SMTP_FROM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>STORAGE_PATH</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>var/store</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where do we store uploaded files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>MINIO_ENDPOINT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>MINIO_SECURE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>MINIO_ACCESS_KEY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>MINIO_SECRET_KEY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>MINIO_SSEC_KEY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>MINIO_BUCKET</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>MINIO_STRICT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_delaying_api_execution"><a class="anchor" href="#_delaying_api_execution"></a>Delaying API execution</h4>
<div class="paragraph">
<p>With <code>WAIT_FOR*</code> Delaying API execution, waiting for external (HTTP) services.</p>
</div>
<div class="paragraph">
<p>This might aid you in complex setup where another service should be running and accessible before Corteza is ready.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>WAIT_FOR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delays API startup for the amount of time specified (10s, 2m&#8230;&#8203;).</p>
<p class="tableblock">This delay happens before service (WAIT_FOR_SERVICES) probing.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>WAIT_FOR_STATUS_PAGE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show temporary status web page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>WAIT_FOR_SERVICES</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Space delimited list of hosts and/or URLs to probe.
Host format: <code>host</code> or <code>host:443</code> (port will default to 80).</p>
<p class="tableblock">Services are probed in parallel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>WAIT_FOR_SERVICES_TIMEOUT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max time for each service probe.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>WAIT_FOR_SERVICES_PROBE_TIMEOUT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout for each service probe.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>WAIT_FOR_SERVICES_PROBE_INTERVAL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interval between service probes.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_corredor_server"><a class="anchor" href="#_corredor_server"></a>Corredor Server</h3>
<div class="paragraph">
<p>Environmental variables used by Corredor and API Server when connected to and communicating with Corredor.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_ADDR</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>corredor:80</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This setting is used by both, Corredor and API Server.</p>
<p class="tableblock">For Corredor server: where is server listening on</p>
<p class="tableblock">For API server: where can Corredor server be accessed.</p>
<p class="tableblock"><em>Used by Corredor and API server.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_ENABLED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a setting for API server, will Corredor be used for server automation?</p>
<p class="tableblock"><em>Used by Corredor and API server.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_MAX_BACKOFF_DELAY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>duration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection timeout (from API server to Corredor)</p>
<p class="tableblock"><em>Used by API server.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_API_BASE_URL_COMPOSE</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the compose API (example: <code><a href="https://api.your-corteza-instance.tld/compose" class="bare">https://api.your-corteza-instance.tld/compose</a></code>)</p>
<p class="tableblock"><em>Used by API server.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_API_BASE_URL_MESSAGING</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the messagign API (example: <code><a href="https://api.your-corteza-instance.tld/messagig" class="bare">https://api.your-corteza-instance.tld/messagig</a></code>)</p>
<p class="tableblock"><em>Used by API server.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_API_BASE_URL_SYSTEM</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of the system API (example: <code><a href="https://api.your-corteza-instance.tld/system" class="bare">https://api.your-corteza-instance.tld/system</a></code>)</p>
<p class="tableblock"><em>Used by API server.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_LOG_ENABLED</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>corredor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This setting is used by both, Corredor and API Server.</p>
<p class="tableblock">For Corredor service: where is service listening on (gRPC)</p>
<p class="tableblock">For API server: where can Corredor service be accessed.</p>
<p class="tableblock"><em>Used by Corredor and API server.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_LOG_LEVEL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bool</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If set to true, API server will log communication with Corredor and Corredor will log incoming requests.</p>
<p class="tableblock"><em>Used by Corredor and API server.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_LOG_LEVEL</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>string</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defaults to <code>trace</code> when <code>CORREDOR_DEBUG</code> is <code>true</code>, defines amount of log information outputed.</p>
<p class="tableblock"><em>Used by Corredor and API server.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_LOG_PRETTY</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Are events logged in one-line JSON or formatted to ease development?</p>
<p class="tableblock"><em>Used by Corredor.</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code>CORREDOR_DEBUG</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boolean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Corredor will log even more information</p>
<p class="tableblock"><em>Used by Corredor.</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_email_automation_processing_inbound_email"><a class="anchor" href="#_email_automation_processing_inbound_email"></a>Email automation: processing inbound email</h3>
<div class="paragraph">
<p>Corteza supports email automation and processing of incoming email messages.
This can be achieved through local email service like <a href="#postfix">[postfix]</a> or 3rd party provider that forward received emails through webhooks.</p>
</div>
<div class="olist arabic">
<div class="title">Flow:</div>
<ol class="arabic">
<li>
<p>Email is received by internal or external system</p>
</li>
<li>
<p>Email is forwarded to sink API endpoint</p>
</li>
<li>
<p>Corteza sink service extracts header and body data from received email</p>
</li>
<li>
<p>onReceive triggers are filtered for a match (trigger can be configured to match specific headers like sender or subject)</p>
</li>
<li>
<p>Automation script is called</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_preparing_signing_sink_url"><a class="anchor" href="#_preparing_signing_sink_url"></a>Preparing (signing) sink URL</h4>
<div class="paragraph">
<p>Signing the URL (the sign=&#8230;&#8203; parameter and value) is created as a combination of all parameters and Corteza&#8217;s secret string.
This signature should be kept secret as it is effectively same as password that allows access to Corteza.</p>
</div>
<div class="listingblock">
<div class="title">Example:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell script hljs" data-lang="shell script">docker-compose exec server system sink signature --method POST --origin postfix --content-type email</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Command will output a line that looks like this:</div>
<div class="content">
<pre class="highlightjs highlight"><code>/sink?content-type=email&amp;expires=&amp;method=POST&amp;origin=postfix&amp;sign=6280d530ae74f1f9c55e4dd362c9ef2094221287</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Parameters:</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">method</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">must match the request method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">origin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">arbitrary string, can be used to describe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">content-type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">used to set the processor for the data inputed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">expires</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">can be used to sign link with expiration date.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Validation</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">echo "
From: <sender@cortezaproject.org>
To: <test@corteza.domain.tld>
Subject: hello
Message-ID: <1234@local.machine.example>

Ola Corteza!
" | curl -i --data-binary @- "https://api.your-corteza-instance.tld/system/sink?content-type=email&expires=&method=POST&origin=postfix&sign=6280d530ae74f1f9c55e4dd362c9ef2094221287'"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command must return <code>200 OK</code> response.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup"><a class="anchor" href="#backup"></a>Backup and restore</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend doing regular backups of database and uploaded files.
Also, it is highly recommended to do a database backup before you upgrade to newer version if Corteza</p>
</div>
<div class="sect2">
<h3 id="_database"><a class="anchor" href="#_database"></a>Database</h3>
<div class="paragraph">
<p>We recommend use of <code>mysqldump</code> tool to backup your Corteza database.
Tool can be found inside <code>db</code> container (<code>percona:8.0</code> image).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not try to copy raw database files to perform backup.
It might lead to corrupted backup data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Database dump command:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker-compose exec -T \
    --env MYSQL_PWD=your-password db \
    mysqldump your-db-name --add-drop-database -u your-username &gt; dump.sql</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will dump entire database and place it in <code>dump.sql</code> file.
If you want to use a different tool to create your backup you will need to connect to the container or publish mysql ports.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can backup your data without shutting down Corteza server.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_database_restore"><a class="anchor" href="#_database_restore"></a>Database restore</h3>
<div class="listingblock">
<div class="title">Database restore command:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">docker-compose exec -T \
    --env MYSQL_PWD=your-password db \
    mysql your-db-name -u your-username &lt; dump.sql</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We recommend that Corteza server is shut-down until restore procedure is done.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_uploaded_files"><a class="anchor" href="#_uploaded_files"></a>Uploaded files</h3>
<div class="paragraph">
<p>Without object storage service like Min.io (see <a href="#Object storage with Minio">[Object storage with Minio]</a>), uploaded files are stored directly on the file-system.
Corteza server is storing data to <code>/data</code> directory (if not configured diffrently with <code>*_STORAGE_PATH</code> environmental variables).</p>
</div>
<div class="paragraph">
<p>You can use anyone of the standard file management tools to make backup copy of the files</p>
</div>
<div class="listingblock">
<div class="title">Compressing files with tar command:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">tar -cjf foo.tar.bz2 data/server/</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_restoring_files"><a class="anchor" href="#_restoring_files"></a>Restoring files</h3>
<div class="listingblock">
<div class="title">Uncompromising files from archive with tar command:</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell">tar -xjf foo.tar.bz2</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
