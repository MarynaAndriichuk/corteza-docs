include::../variables.adoc[]

= Anatomy of a script

== Minimum script
[source,javascript]
----
export default {
  triggers ({ on }) {
    return on('manual').for('compose:record')
  },

  exec () {
    // script's code
  },
}
----

Corredor expects one or more exported objects (`{ ... }`) from each script file.
Each exported object should contain at least one trigger and an exec function to be considered valid.

Invalid scripts will be processed as well and served from corredor with all detected errors and warnings.



//== Authenticated user ($authUser)
//
//Access info (User object) about the authenticated user (user who's running the script)
//
//== Current $record, current $module
//
//On automatically triggered scripts (before/after-create/update/delete) events and manually triggered scripts on record-pages, scripts can use $record and $module variables to access current record and/or current module.
//
//In all methods where there is a function param for record or module that param can be omitted (or NULL-ed) and function will use current record or module (when available)
//
//== Module parameter
//
//Resolution rules for module parameter in every ComposeHelper class method:
//
//- if string contains only digits, use as module ID and load module
//- if string, use as module name and load module
//- object, verify that it has namespaceID and moduleID properties
//- if null, use current $module (when available)
//
//
//
//= Returning values
//
//You can abort script execution by returning (`return ...`) at any point in the script.
//Returning `false` will cause abort and will prevent record create/update/delete in before* triggers.
//
//You can always return the (changed) record you're currently running the script for and cause that a modified (by your script) version of an object is then passed back to Compose.
//This can be used in beforeCreate and beforeUpdate triggers to save modified version or in manual triggers to change the current record on the fly (even without explicitly saving it in the script)
//
//== Modifying current $record and returning from automation script
//
//.Rules:
//- Critical scripts have to be executed successfully and return [truthy](https://developer.mozilla.org/en-US/docs/Glossary/Truthy) value.
//- If automation scripts returns Record system will update current $record (if Module then $module, etc...)
//- Modifications of $record (and other $*) and return values of async scripts are ignored
//- Modifications of $record (and other $*) and return values of after* triggers are ignored
//
