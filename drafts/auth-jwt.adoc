=== Obtaining access token (JWT)

To obtain access tokens that allow you to access to Corteza resources you need a user and an auth client.

Choose an existing user or create a new one and make him a member of roles that will allow actions that you need to perform. It's strongly recomended that you create a dedicated user just for this purpose.

Create new auth client with `client_credentials` grant type and under "Impersonate user" insert the ID of the selected user.


.Access token request structure
[source,shell]
----
curl -X POST \
     -d grant_type=client_credentials \
     -d scope=api \
     -u <client id>:<client secret> \
     your-corteza-instance.tld/auth/oauth2/token
----

.Access token request example
[source,shell]
----

curl -X POST \
     -d grant_type=client_credentials \
     -d scope=api \
     -u 229978909641277628:sMVVcYpXE6bOUm6gG0sJGKmDOzEgkYyhvKyrmcU9fGY8M4GhLd90lThZDxUUFLC9 \
     your-corteza-instance.tld/auth/oauth2/token
----

.Access token response example
[source,json]
----
{
  "access_token": "eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiIyMjk5Nzg5MDk2NDEyNzc2MjgiLCJleHAiOjE2MjAzMTQ5NzEsInJvbGVzIjoiIiwic2NvcGUiOiJhcGkiLCJzdWIiOiIyMjk5NzQ5MDk2NDEyNzcxMjEifQ.qy-1jbSkQp1nXvBk_hqVnIUI1gny-_f81fi3hrYuJIyZZbLMhq7cr0Ubah3bAniqr7PCf361I7lGIXCk09MsLA",
  "expires_in": 7200,
  "refresh_token_expires_in": 0,
  "scope": "api",
  "sub": "229974909641277121",
  "token_type": "Bearer"
}
----

[NOTE]
====
Keep an eye on the expiration!
====

== Troubleshooting

Error: "auth client security configuration invalid"::
    ID of impersonated user is not set
